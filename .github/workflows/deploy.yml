name: æ˜ åƒå·¥æˆ¿ - éƒ¨ç½²å·¥ä½œæµ

on:
  push:
    branches: [ main, development ]
  pull_request:
    branches: [ main, development ]

jobs:
  test:
    runs-on: ubuntu-latest
    
    steps:
    - uses: actions/checkout@v3
    
    - name: è®¾ç½® Node.js
      uses: actions/setup-node@v3
      with:
        node-version: '18'
        cache: 'npm'
    
    - name: å®‰è£…ä¾èµ–
      run: npm ci
    
    - name: è¿è¡Œè¯­æ³•æ£€æŸ¥
      run: npm run lint
    
    - name: æ„å»ºé¡¹ç›®
      run: npm run build
    
    - name: è¿è¡Œæµ‹è¯•
      run: |
        echo "æµ‹è¯•åŠŸèƒ½å¾…å®ç°"
        # npm run test

  deploy-development:
    needs: test
    runs-on: ubuntu-latest
    if: github.ref == 'refs/heads/development'
    
    steps:
    - uses: actions/checkout@v3
    
    - name: éƒ¨ç½²åˆ°å¼€å‘ç¯å¢ƒ
      run: |
        echo "å¼€å‘ç¯å¢ƒéƒ¨ç½²"
        echo "Vercel å°†è‡ªåŠ¨å¤„ç† development åˆ†æ”¯çš„éƒ¨ç½²"
    
    - name: é€šçŸ¥å¼€å‘ç¯å¢ƒéƒ¨ç½²å®Œæˆ
      run: |
        echo "âœ… å¼€å‘ç¯å¢ƒéƒ¨ç½²å®Œæˆ"
        echo "ğŸŒ é¢„è§ˆåœ°å€: https://development.eizokobo.vercel.app"

  deploy-production:
    needs: test
    runs-on: ubuntu-latest
    if: github.ref == 'refs/heads/main'
    
    steps:
    - uses: actions/checkout@v3
    
    - name: éƒ¨ç½²åˆ°ç”Ÿäº§ç¯å¢ƒ
      run: |
        echo "ç”Ÿäº§ç¯å¢ƒéƒ¨ç½²"
        echo "Vercel å°†è‡ªåŠ¨å¤„ç† main åˆ†æ”¯çš„éƒ¨ç½²"
    
    - name: é€šçŸ¥ç”Ÿäº§ç¯å¢ƒéƒ¨ç½²å®Œæˆ
      run: |
        echo "âœ… ç”Ÿäº§ç¯å¢ƒéƒ¨ç½²å®Œæˆ"
        echo "ğŸŒ ç”Ÿäº§åœ°å€: https://eizokobo.vercel.app"
    
    - name: å‘é€éƒ¨ç½²é€šçŸ¥
      run: |
        echo "å‘é€éƒ¨ç½²æˆåŠŸé€šçŸ¥é‚®ä»¶"
        # è¿™é‡Œå¯ä»¥é›†æˆé‚®ä»¶é€šçŸ¥æˆ– Slack é€šçŸ¥

  security-scan:
    runs-on: ubuntu-latest
    if: github.ref == 'refs/heads/main'
    
    steps:
    - uses: actions/checkout@v3
    
    - name: è¿è¡Œå®‰å…¨æ‰«æ
      run: |
        echo "è¿è¡Œå®‰å…¨æ‰«æ"
        # npm audit
        # å¯ä»¥é›†æˆå…¶ä»–å®‰å…¨æ‰«æå·¥å…· 